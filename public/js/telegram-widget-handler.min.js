"use strict";

function onTelegramAuth(e) {
    var r, t, n, a;
    if (!e) return console.error("User data not found");
    let gender = null
    const popUpWrapper = document.createElement("div")
    const popUp = document.createElement("div")
    const popUpTitle = document.createElement("p")
    const checkBoxesWrapper = document.createElement("div")
    const checkBoxContainer1 = document.createElement("div")
    const checkBoxContainer2 = document.createElement("div")
    const checkBoxTitle1 = document.createElement("p")
    const checkBoxTitle2 = document.createElement("p")
    const checkBox1 = document.createElement("input")
    const checkBox2 = document.createElement("input")
    const button = document.createElement("button")

    popUpWrapper.style.position = "fixed"
    popUpWrapper.style.height = "100%"
    popUpWrapper.style.width = "100%"
    popUpWrapper.style.backgroundColor = "rgba(0,0,0,0.25)"
    popUpWrapper.style.zIndex = "1000"
    popUpWrapper.style.display = "flex"
    popUpWrapper.style.alignItems = "center"
    popUpWrapper.style.justifyContent = "center"

    popUp.style.width = "250px"
    popUp.style.background = "white"
    popUp.style.display = "flex"
    popUp.style.flexDirection = "column"
    popUp.style.alignItems = "center"
    popUp.style.justifyContent = "center"
    popUp.style.rowGap = "15px"
    popUp.style.padding =  "24px 32px";

    popUpTitle.innerText  = "Выберите пол"
    popUpTitle.style.fontFamily = "Arial"
    popUpTitle.style.fontWeight = "600"
    popUpTitle.style.fontSize = "20px"

    checkBoxesWrapper.style.display = "flex"
    checkBoxesWrapper.style.alignItems = "center"
    checkBoxesWrapper.style.justifyContent = "center"
    checkBoxesWrapper.style.columnGap = "15px"

    checkBoxContainer1.style.display = "flex"
    checkBoxContainer1.style.alignItems = "center"
    checkBoxContainer1.style.justifyContent = "center"
    checkBoxContainer1.style.columnGap = "7px"

    checkBoxContainer2.style.display = "flex"
    checkBoxContainer2.style.alignItems = "center"
    checkBoxContainer2.style.justifyContent = "center"
    checkBoxContainer2.style.columnGap = "7px"

    checkBoxTitle1.innerText  = "Мужчина"
    checkBoxTitle1.style.fontFamily = "Arial"
    checkBoxTitle1.style.fontWeight = "500"

    checkBoxTitle2.innerText  = "Женщина"
    checkBoxTitle2.style.fontFamily = "Arial"
    checkBoxTitle2.style.fontWeight = "500"

    checkBox1.type = "checkbox"
    checkBox1.onclick = () => {
        checkBox2.checked = false
        checkBox1.checked = true
        gender = "male"
    }

    checkBox2.type = "checkbox"
    checkBox2.onclick = () => {
        checkBox1.checked = false
        checkBox2.checked = true
        gender = "female"
    }

    button.style.padding =  "6px 18px";
    button.style.textTransform = "uppercase";
    button.style.justifyContent = "center";
    button.style.cursor = "pointer";
    button.style.alignItems = "center";
    button.style.outline = "none";
    button.style.fontSize = "14px";
    button.style.fontWeight = "500";
    button.style.fontFamily = "Arial"
    button.style.borderRadius = "10px";
    button.style.alignSelf = "flex-end"
    button.style.border = "none";
    button.style.backgroundColor = "#4768b5";
    button.style.color = "white";
    button.innerText = "ок"

    popUp.appendChild(popUpTitle)
    popUp.appendChild(checkBoxesWrapper)
    popUp.appendChild(button)
    checkBoxesWrapper.appendChild(checkBoxContainer1)
    checkBoxesWrapper.appendChild(checkBoxContainer2)
    checkBoxContainer1.appendChild(checkBox1)
    checkBoxContainer1.appendChild(checkBoxTitle1)
    checkBoxContainer2.appendChild(checkBox2)
    checkBoxContainer2.appendChild(checkBoxTitle2)
    popUpWrapper.appendChild(popUp)
    document.body.appendChild(popUpWrapper)

    button.onclick = () => {
        if (gender === null) return
        popUpWrapper.remove()
        fetch("/api/Account/AuthViaTelegram", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                id: e.id,
                firstName: null !== (r = e.first_name) && void 0 !== r ? r : "",
                lastName: null !== (t = e.last_name) && void 0 !== t ? t : "",
                userName: null !== (n = e.username) && void 0 !== n ? n : "",
                photoUrl: null !== (a = e.photo_url) && void 0 !== a ? a : "",
                authDate: e.auth_date,
                hash: e.hash,
                gender
            })
        }
        ).then(function (e) {
            return e.json();
        }).then(function (e) {
            var r = e.accessToken,
                t = e.refreshToken;
            if (!(r && t)) return console.error("Response data error");
            localStorage.setItem("accessToken", r), localStorage.setItem("refreshToken", t), location.replace("/chat");
        }).catch(console.error);
    }
}
;